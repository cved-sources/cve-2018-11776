FROM tomcat:7-alpine

LABEL author="knqyf263 (knqyf263@gmail.com)"
LABEL maintainer="cved (cved@protonmail.com)"

ENV LANG C.UTF-8
ENV LANGUAGE C.UTF-8
ENV LC_ALL C.UTF-8

RUN apk add --no-cache --update zip

COPY build/showcase.war /src/

RUN rm -rf /usr/local/tomcat/webapps/* \
    && cd /src \
    && mkdir showcase \
    && unzip showcase.war -d showcase \
    && sed -i "80i\ \n\t<action name=\"chain\">\n\t\t<result type=\"chain\">date</result>\n\t</action>" /src/showcase/WEB-INF/classes/struts.xml \
    && cd showcase \
    && zip -r ROOT.war ./ \
    && mv /src/showcase/ROOT.war /usr/local/tomcat/webapps/ \
    && rm -rf /src

EXPOSE 8080

